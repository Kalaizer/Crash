<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crash Game</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc, onSnapshot, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

        // üî• –¢–í–û–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø FIREBASE (–ó–ê–ú–ï–ù–ò –î–ê–ù–ù–´–ú–ò –ò–ó FIREBASE)
        const firebaseConfig = {
            apiKey: "–¢–í–û–ô_API_KEY",
            authDomain: "–¢–í–û–ô_AUTH_DOMAIN",
            projectId: "–¢–í–û–ô_PROJECT_ID",
            storageBucket: "–¢–í–û–ô_STORAGE_BUCKET",
            messagingSenderId: "–¢–í–û–ô_MESSAGING_SENDER_ID",
            appId: "–¢–í–û–ô_APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // –°—Å—ã–ª–∫–∏ –Ω–∞ –¥–∞–Ω–Ω—ã–µ Firebase
        const gameRef = doc(db, "game", "current");
        const historyRef = collection(db, "history");
        const userBalanceRef = doc(db, "users", "user1");

        let balance = 0;
        let betAmount = 0;
        let isBetPlaced = false;
        let coefficient = 1.0;
        let interval;
        let timer = 5;

        // üî• –ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ —Ä–∞—É–Ω–¥–∞
        async function startGame() {
            coefficient = 1.0;
            timer = 5;
            document.getElementById("timer").innerText = `–ù–æ–≤—ã–π —Ä–∞—É–Ω–¥ —á–µ—Ä–µ–∑: ${timer}`;
            
            let countdown = setInterval(() => {
                timer--;
                document.getElementById("timer").innerText = `–ù–æ–≤—ã–π —Ä–∞—É–Ω–¥ —á–µ—Ä–µ–∑: ${timer}`;
                if (timer === 0) clearInterval(countdown);
            }, 1000);

            await new Promise(resolve => setTimeout(resolve, 5000));

            interval = setInterval(async () => {
                coefficient += 0.01;
                await setDoc(gameRef, { coefficient: coefficient }, { merge: true });

                if (coefficient >= 10) stopGame();
            }, 100);
        }

        // üî• –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–≥—Ä—É
        async function stopGame() {
            clearInterval(interval);
            document.getElementById("history").innerHTML += `<p>${coefficient.toFixed(2)}x</p>`;
            await addDoc(historyRef, { coefficient: coefficient });

            isBetPlaced = false;
            setTimeout(startGame, 5000);
        }

        // üî• –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        onSnapshot(gameRef, (doc) => {
            if (doc.exists()) {
                coefficient = doc.data().coefficient;
                document.getElementById("coefficientDisplay").innerText = `–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç: ${coefficient.toFixed(2)}x`;
            }
        });

        // üî• –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
        onSnapshot(userBalanceRef, (doc) => {
            if (doc.exists()) {
                balance = doc.data().balance;
                document.getElementById("balance").innerText = `–ë–∞–ª–∞–Ω—Å: ${balance.toFixed(1)} –º–æ–Ω–µ—Ç`;
            }
        });

        // üî• –°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É
        async function placeBet() {
            if (isBetPlaced) {
                alert("–í—ã —É–∂–µ —Å–¥–µ–ª–∞–ª–∏ —Å—Ç–∞–≤–∫—É!");
                return;
            }

            let inputAmount = parseFloat(document.getElementById("betAmount").value);
            if (isNaN(inputAmount) || inputAmount <= 0 || inputAmount > balance) {
                alert("–ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞ —Å—Ç–∞–≤–∫–∏!");
                return;
            }

            betAmount = inputAmount;
            balance -= betAmount;
            isBetPlaced = true;

            await setDoc(userBalanceRef, { balance: balance }, { merge: true });
        }

        // üî• –í—ã–≤–µ—Å—Ç–∏ –¥–µ–Ω—å–≥–∏
        async function cashOut() {
            if (!isBetPlaced) return;
            balance += betAmount * coefficient;
            isBetPlaced = false;

            await setDoc(userBalanceRef, { balance: balance }, { merge: true });
        }

        // üî• –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
        function showAdminPanel() {
            let password = prompt("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å:");
            if (password === "1001") {
                let amount = parseFloat(prompt("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:"));
                if (!isNaN(amount) && amount > 0) {
                    setDoc(userBalanceRef, { balance: balance + amount }, { merge: true });
                }
            } else {
                alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!");
            }
        }

        window.placeBet = placeBet;
        window.cashOut = cashOut;
        window.showAdminPanel = showAdminPanel;

        startGame(); // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É
    </script>
    <style>
        body { text-align: center; font-family: Arial, sans-serif; background-color: #222; color: #fff; }
        button { margin: 5px; padding: 10px 20px; background: orange; border: none; cursor: pointer; }
        input { padding: 10px; }
        .admin { position: fixed; bottom: 10px; right: 10px; background: red; padding: 5px 10px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Crash Game</h1>
    <h2 id="coefficientDisplay">–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç: 1.00x</h2>
    <h3 id="timer">–ù–æ–≤—ã–π —Ä–∞—É–Ω–¥ —á–µ—Ä–µ–∑: 5</h3>
    <h3 id="balance">–ë–∞–ª–∞–Ω—Å: 0 –º–æ–Ω–µ—Ç</h3>

    <input type="number" id="betAmount" placeholder="–°—É–º–º–∞ —Å—Ç–∞–≤–∫–∏">
    <button onclick="placeBet()">–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É</button>
    <button onclick="cashOut()">–í—ã–≤–µ—Å—Ç–∏ –¥–µ–Ω—å–≥–∏</button>

    <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤:</h3>
    <div id="history"></div>

    <div class="admin" onclick="showAdminPanel()">–ê–¥–º–∏–Ω</div>
</body>
</html>
