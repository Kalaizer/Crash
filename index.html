<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crash Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f8f8f8;
            color: #333;
            margin: 0;
            padding: 0;
        }

        .game-interface {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .balance-panel {
            font-size: 24px;
            margin-bottom: 20px;
        }

        .game-controls button {
            font-size: 18px;
            margin: 10px;
            padding: 10px 20px;
            background-color: #ff8c00;
            border: none;
            color: white;
            cursor: pointer;
        }

        .game-controls button:hover {
            background-color: #ff6600;
        }

        #gameInfo {
            margin-top: 20px;
        }

        #gameInfo p {
            font-size: 20px;
        }

        #graph {
            width: 100%;
            height: 300px;
            margin-top: 30px;
        }

        .admin-panel {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background-color: #f4f4f4;
            padding: 10px;
            border: 1px solid #ccc;
            font-size: 14px;
        }

        .admin-panel input {
            padding: 5px;
        }
    </style>
</head>
<body>

<div class="game-interface">
    <div class="balance-panel">
        <h2>Баланс: <span id="balance">0</span> рублей</h2>
    </div>

    <div class="game-controls">
        <button id="startGameButton" onclick="startGame()">Начать игру</button>
        <button id="placeBetButton" onclick="placeBet()">Поставить ставку</button>
        <button id="withdrawButton" onclick="withdraw()">Вывести деньги</button>
    </div>

    <div id="gameInfo">
        <p>Текущий коэффициент: <span id="currentCoefficient">1.00</span></p>
        <p>Возможный выигрыш: <span id="possibleWin">0</span></p>
    </div>

    <canvas id="graph"></canvas>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore.js"></script>

<script>
    // Инициализация Firebase
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_AUTH_DOMAIN",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_STORAGE_BUCKET",
        messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
        appId: "YOUR_APP_ID"
    };
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    let balance = 0;
    let betAmount = 0;
    let currentCoefficient = 1.0;

    // Функции Firebase для аутентификации
    function signUp() {
        const email = prompt("Введите ваш email:");
        const password = prompt("Введите ваш пароль:");

        auth.createUserWithEmailAndPassword(email, password)
            .then((userCredential) => {
                const user = userCredential.user;
                console.log("Регистрация успешна:", user.email);
            })
            .catch((error) => {
                console.error("Ошибка регистрации:", error);
            });
    }

    function signIn() {
        const email = prompt("Введите ваш email:");
        const password = prompt("Введите ваш пароль:");

        auth.signInWithEmailAndPassword(email, password)
            .then((userCredential) => {
                const user = userCredential.user;
                console.log("Вход успешен:", user.email);
                getUserBalance(user.uid);
            })
            .catch((error) => {
                console.error("Ошибка входа:", error);
            });
    }

    // Функция для получения баланса
    function getUserBalance(userId) {
        db.collection("users").doc(userId).get()
            .then((doc) => {
                if (doc.exists) {
                    balance = doc.data().balance;
                    document.getElementById("balance").innerText = balance;
                }
            })
            .catch((error) => {
                console.error("Ошибка получения баланса:", error);
            });
    }

    // Функция для обновления баланса в Firestore
    function updateBalance(userId, newBalance) {
        db.collection("users").doc(userId).update({
            balance: newBalance
        }).then(() => {
            console.log("Баланс обновлен");
            balance = newBalance;
            document.getElementById("balance").innerText = balance;
        }).catch((error) => {
            console.error("Ошибка обновления баланса:", error);
        });
    }

    // Функции игры
    function startGame() {
        currentCoefficient = 1.0;
        document.getElementById("currentCoefficient").innerText = currentCoefficient;
        let graphData = [];

        // Логика увеличения коэффициента
        const interval = setInterval(() => {
            currentCoefficient += 0.01;
            graphData.push(currentCoefficient);
            document.getElementById("currentCoefficient").innerText = currentCoefficient.toFixed(2);

            if (currentCoefficient >= 5) {  // Пример окончания игры
                clearInterval(interval);
                alert("Игра завершена! Коэффициент: " + currentCoefficient);
            }

            drawGraph(graphData); // Рисуем график
        }, 1000);
    }

    function placeBet() {
        const betInput = prompt("Введите сумму ставки:");
        betAmount = parseFloat(betInput);

        if (isNaN(betAmount) || betAmount <= 0) {
            alert("Пожалуйста, введите корректную сумму ставки.");
            return;
        }

        const possibleWin = betAmount * currentCoefficient;
        document.getElementById("possibleWin").innerText = possibleWin.toFixed(2);
    }

    function withdraw() {
        const possibleWin = betAmount * currentCoefficient;
        balance += possibleWin;
        document.getElementById("balance").innerText = balance.toFixed(2);

        // Сохранение баланса в Firebase
        const user = auth.currentUser;
        if (user) {
            updateBalance(user.uid, balance);
        }
    }

    // Рисуем график
    function drawGraph(data) {
        const ctx = document.getElementById('graph').getContext('2d');
        const labels = data.map((_, index) => index + 1);
        const graph = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Коэффициент',
                    data: data,
                    borderColor: '#ff8c00',
                    borderWidth: 2,
                    fill: false
                }]
            },
            options: {
                scales: {
                    x: {
                        beginAtZero: true
                    },
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</body>
</html>
